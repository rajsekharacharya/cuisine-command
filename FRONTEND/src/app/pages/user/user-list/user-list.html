<!-- Loading State -->
@if (loading) {
<div class="text-center p-5 loading-state">
  <div class="spinner-border text-primary spinner-lg" role="status">
    <span class="visually-hidden">Loading...</span>
  </div>
  <p class="mt-3 text-muted"><span class="icon-common-vivid icon-utensils"></span>Cooking up your data...</p>
</div>
}


@if (!loading && users.length > 0) {
<div class="body-area-content">
  <div class="table-container">
    <table class="table-view">
      <tr class="table-head-primary">
        <th class="col-sl">#</th>
        <th (click)="changeSort('name')" (keydown)="handleKeyDown($event)" [class.sort-active]="sortField === 'name'">
          Name</th>
        <th (click)="changeSort('username')" (keydown)="handleKeyDown($event)"
          [class.sort-active]="sortField === 'username'">
          Username</th>
        <th (click)="changeSort('role')" (keydown)="handleKeyDown($event)" [class.sort-active]="sortField === 'role'">
          Role</th>
        <th (click)="changeSort('email')" (keydown)="handleKeyDown($event)" [class.sort-active]="sortField === 'email'">
          Email</th>
        <th (click)="changeSort('mobile')" (keydown)="handleKeyDown($event)"
          [class.sort-active]="sortField === 'mobile'">Mobile</th>
        <th>Verify</th>
        <th>Enable</th>
        <th class="col-action">Action</th>
      </tr>
      @if (loading) {
      @for (row of loaderRows; track $index) {
      <tr>
        @for (cell of loaderCells; track $index) {
        <td>
          <div class="loader-mask" [class.action]="$index === loaderCells.length - 1"></div>
        </td>
        }
        <td>
          <div class="loader-mask action"></div>
        </td>
      </tr>
      }
      }
      @else if (!loading && users.length === 0) {
      <tr>
        <td colspan="10" class="text-center">
          No records to display
        </td>
      </tr>
      }
      @else {
      @for ( user of users; track $index) {
      <tr>
        <td class="col-sl">{{ $index + 1 }}</td>
        <td>{{ user.name }}</td>
        <td>{{ user.username }}</td>
        <td>{{ user.role }}</td>
        <td>{{ user.email }}</td>
        <td>{{ user.mobile }}</td>
        <td>{{ user.verified ? 'Yes' : 'No' }}</td>
        <td>{{ user.enabled ? 'Active' : 'Inactive' }}</td>
        <td class="col-action">
          <div class="dropdown">
            <button class="btn btn-icon btn-option" type="button" id="dropdownMenuButton{{ user.id }}"
              data-bs-toggle="dropdown" aria-expanded="false" [disabled]="loading">
              <span class="icon-common icon-option icon-btn-circle"></span>
            </button>
            <ul class="dropdown-menu" [attr.aria-labelledby]="'dropdownMenuButton' + user.id">
              <li>
                <a class="dropdown-item" (click)="editUser(user)">
                  <span class="icon-common icon-dropdown icon-edit"></span>
                  <span class="lbl-action lbl-edit">Edit</span>
                </a>
              </li>
              <li>
                <a class="dropdown-item" (click)="setUserToDelete(user.id)" data-bs-toggle="modal"
                  data-bs-target="#userDeleteConfirmation" #triggerButton>
                  <span class="icon-common icon-dropdown icon-trash"></span>
                  <span class="lbl-action lbl-delete">Deactivate</span>
                </a>
              </li>
            </ul>
          </div>
        </td>
      </tr>
      }
      }
    </table>
  </div>

  <div class="pagination-container">
    <nav aria-label="Page navigation example">
      <ul class="pagination justify-content-center align-items-center">
        <!-- First Page -->
        <li class="page-item" [class.disabled]="currentPage === 0">
          <a class="page-link" (click)="goToPage(0)" aria-label="First">
            <i class="bi bi-chevron-double-left"></i>
          </a>
        </li>

        <!-- Previous Page -->
        <li class="page-item" [class.disabled]="currentPage === 0">
          <a class="page-link" (click)="goToPage(currentPage - 1)" aria-label="Previous">
            <i class="bi bi-chevron-left"></i>
          </a>
        </li>

        <!-- Page Numbers (Dynamic, e.g., limited to 3-5 visible) -->
        <ng-container *ngFor="let page of getPageNumbers()">
          <li class="page-item" [class.active]="currentPage === page">
            <a class="page-link" (click)="goToPage(page)">{{ page + 1 }}</a>
          </li>
        </ng-container>

        <!-- Total Pages Display -->
        <li class="page-item total-pages">
          <span class="page-link">of {{ totalPages }}</span>
        </li>

        <!-- Next Page -->
        <li class="page-item" [class.disabled]="currentPage === totalPages - 1">
          <a class="page-link" (click)="goToPage(currentPage + 1)" aria-label="Next">
            <i class="bi bi-chevron-right"></i>
          </a>
        </li>

        <!-- Last Page -->
        <li class="page-item" [class.disabled]="currentPage === totalPages - 1">
          <a class="page-link" (click)="goToPage(totalPages - 1)" aria-label="Last">
            <i class="bi bi-chevron-double-right"></i>
          </a>
        </li>
      </ul>
    </nav>
  </div>

</div>
}

<!-- User Delete Confirmation Modal -->
<div class="modal fade" data-bs-backdrop="static" data-bs-keyboard="false" id="userDeleteConfirmation" tabindex="-1"
  aria-labelledby="userDeleteConfirmation" appTeleportModal #userDeleteConfirmation>
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content overflow-hidden">
      <div class="modal-header">
        <div class="modal-title">
          <span class="icon-common icon-modal-header icon-exclamation"></span>
          <span>Delete User?</span>
        </div>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"
          (click)="closeModal('userDeleteConfirmation')">
          <span class="icon-common icon-cross"></span>
        </button>
      </div>
      <div class="modal-body">
        <div class="lbl-confirmation">Are you sure, you want to delete this user?</div>
      </div>

      <div class="modal-footer">
        <button class="btn btn-secondary btn-modal-action"
          (click)="closeModal('userDeleteConfirmation')">Cancel</button>
        <button class="btn btn-danger btn-modal-action" [disabled]="loading">
          {{ loading ? 'Deleting...' : 'Delete' }}
        </button>
      </div>
    </div>
  </div>
</div>

<div class="modal fade modal-delete-confimation" data-bs-backdrop="static" data-bs-keyboard="false"
  id="userDeleteConfirmation" tabindex="-1" aria-labelledby="userDeleteConfirmation" appTeleportModal
  #userDeleteConfirmation>
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content overflow-hidden">
      <div class="modal-close">
        <button type="button" class="btn-close" (click)="closeModal('userDeleteConfirmation')">
          <span class="icon-common icon-cross"></span>
        </button>
      </div>
      <div class="modal-body">
        <img src="/images/img-delete.svg" alt="" class="img-delete-confirmation">
        <div class="lbl-confirmation">Want to Delete?</div>
        <div class="lbl-warning"><span>Are you sure, want to delete this user? <br> You will </span><span
            class="lbl-danger">not be able to recover </span><span>it.</span></div>
      </div>

      <div class="modal-footer">
        <button class="btn-common btn-confirm btn-modal-action" [disabled]="loading">
          {{ loading ? 'Deleting...' : 'Yes, Delete it' }}
        </button>
        <button class="btn-common btn-cancel btn-modal-action"
          (click)="closeModal('userDeleteConfirmation')">Cancel</button>
      </div>
    </div>
  </div>
</div>
